<% content_for :page_title, 'Complete Your Profile' %>
<% content_for :page_description, 'Complete your SSGrip profile setup' %>

<section class="bg-ssgrip-darkest min-h-screen text-white flex items-center justify-center py-12 px-6">
  <div class="w-full max-w-2xl">
    <!-- Header -->
    <div class="text-center mb-10">
      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-ssgrip-silver/10 border border-ssgrip-silver/20 mb-6">
        <span class="text-xs font-bold text-ssgrip-silver uppercase tracking-[0.3em]">Profile Setup</span>
      </div>
      
      <h1 class="text-4xl md:text-5xl font-black text-white mb-4">
        Complete Your Profile
      </h1>
      <p class="text-ssgrip-silver text-lg">Help us personalize your experience with SSGrip</p>
    </div>

    <!-- Profile Form Card -->
    <div class="rounded-xl border border-ssgrip-silver/10 bg-ssgrip-darker/30 p-8">
      <%= form_with model: @user, url: update_info_path, method: :patch, local: true, class: "space-y-6", id: "profile-form" do |form| %>
        
        <!-- First Name -->
        <div class="space-y-2">
          <label for="user_first_name" class="block text-sm font-semibold text-ssgrip-silver uppercase tracking-wider">
            First Name <span class="text-red-400">*</span>
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <svg class="w-5 h-5 text-ssgrip-silver-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
            </div>
            <%= form.text_field :first_name, 
                required: true,
                class: "w-full pl-12 pr-4 py-4 bg-ssgrip-darkest/50 border border-ssgrip-silver/20 rounded-lg text-white placeholder-ssgrip-silver-dark focus:outline-none focus:border-ssgrip-silver transition-colors text-lg",
                placeholder: "Enter your first name",
                data: { validation: "name" } %>
          </div>
          <div class="text-xs text-ssgrip-silver-dark">2-50 characters, letters only</div>
          <% if @user.errors[:first_name].any? %>
            <div class="flex items-center space-x-2 text-red-400 text-sm">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              <span><%= @user.errors[:first_name].join(', ') %></span>
            </div>
          <% end %>
        </div>

        <!-- Last Name -->
        <div class="space-y-2">
          <label for="user_last_name" class="block text-sm font-semibold text-ssgrip-silver uppercase tracking-wider">
            Last Name <span class="text-red-400">*</span>
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <svg class="w-5 h-5 text-ssgrip-silver-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
            </div>
            <%= form.text_field :last_name, 
                required: true,
                class: "w-full pl-12 pr-4 py-4 bg-ssgrip-darkest/50 border border-ssgrip-silver/20 rounded-lg text-white placeholder-ssgrip-silver-dark focus:outline-none focus:border-ssgrip-silver transition-colors text-lg",
                placeholder: "Enter your last name",
                data: { validation: "name" } %>
          </div>
          <div class="text-xs text-ssgrip-silver-dark">2-50 characters, letters only</div>
          <% if @user.errors[:last_name].any? %>
            <div class="flex items-center space-x-2 text-red-400 text-sm">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              <span><%= @user.errors[:last_name].join(', ') %></span>
            </div>
          <% end %>
        </div>

        <!-- Phone Number -->
        <div class="space-y-2">
          <label for="user_phone_number" class="block text-sm font-semibold text-ssgrip-silver uppercase tracking-wider">
            Phone Number <span class="text-red-400">*</span>
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <svg class="w-5 h-5 text-ssgrip-silver-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
            </div>
            <%= form.telephone_field :phone_number, 
                required: true,
                class: "w-full pl-12 pr-4 py-4 bg-ssgrip-darkest/50 border border-ssgrip-silver/20 rounded-lg text-white placeholder-ssgrip-silver-dark focus:outline-none focus:border-ssgrip-silver transition-colors text-lg",
                placeholder: "Enter your phone number",
                data: { validation: "phone" } %>
          </div>
          <div class="text-xs text-ssgrip-silver-dark">Valid phone number (e.g., 01234567890)</div>
          <% if @user.errors[:phone_number].any? %>
            <div class="flex items-center space-x-2 text-red-400 text-sm">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              <span><%= @user.errors[:phone_number].join(', ') %></span>
            </div>
          <% end %>
        </div>

        <!-- Form Actions -->
        <div class="flex flex-col sm:flex-row gap-4 pt-6">
          <%= form.submit "Complete Profile", 
              class: "flex-1 bg-white hover:bg-ssgrip-accent-bright text-ssgrip-darkest font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 text-lg",
              data: { turbo: false } %>
          
          <%= link_to dashboard_path, 
              class: "flex-1 sm:flex-none bg-ssgrip-darkest/50 hover:bg-ssgrip-silver/10 text-white font-semibold py-4 px-8 rounded-lg border border-ssgrip-silver/30 hover:border-ssgrip-silver transition-all text-center text-lg" do %>
            <span>Skip for Now</span>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('profile-form');
  const inputs = form.querySelectorAll('input[data-validation]');
  
  inputs.forEach(input => {
    input.addEventListener('blur', function() {
      validateField(this);
    });
    
    input.addEventListener('input', function() {
      clearFieldError(this);
    });
  });
  
  function validateField(field) {
    const value = field.value.trim();
    const validation = field.dataset.validation;
    let isValid = true;
    let errorMessage = '';
    
    if (validation === 'name') {
      if (value.length < 2) {
        isValid = false;
        errorMessage = 'Name must be at least 2 characters';
      } else if (!/^[a-zA-Z\s\-']+$/.test(value)) {
        isValid = false;
        errorMessage = 'Name can only contain letters, spaces, hyphens, and apostrophes';
      }
    } else if (validation === 'phone') {
      if (!/^[\+]?[1-9][\d]{0,15}$/.test(value)) {
        isValid = false;
        errorMessage = 'Please enter a valid phone number';
      }
    }
    
    if (!isValid) {
      showFieldError(field, errorMessage);
    } else {
      clearFieldError(field);
    }
    
    return isValid;
  }
  
  function showFieldError(field, message) {
    field.classList.add('border-red-500', 'focus:border-red-500');
    field.classList.remove('border-ssgrip-silver/20', 'focus:border-ssgrip-silver');
    
    let errorDiv = field.parentNode.querySelector('.field-error');
    if (!errorDiv) {
      errorDiv = document.createElement('div');
      errorDiv.className = 'field-error flex items-center space-x-2 text-red-400 text-sm mt-2';
      field.parentNode.appendChild(errorDiv);
    }
    errorDiv.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg><span>' + message + '</span>';
  }
  
  function clearFieldError(field) {
    field.classList.remove('border-red-500', 'focus:border-red-500');
    field.classList.add('border-ssgrip-silver/20', 'focus:border-ssgrip-silver');
    
    const errorDiv = field.parentNode.querySelector('.field-error');
    if (errorDiv) {
      errorDiv.remove();
    }
  }
});
</script>
